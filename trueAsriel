_G.targetr = nil
_G.OneTeamhit = false
_G.OneTeam = nil

local m1 = true

local player = game.Players.LocalPlayer
local char = player.Character
local root = char.HumanoidRootPart
local rootpart = char.HumanoidRootPart

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LP = Players.LocalPlayer





local Remotes = {}

for idx, val in pairs(game:GetService("ReplicatedStorage"):GetChildren()) do
    if val:IsA("RemoteEvent") then
        Remotes[val.Name] = val
    end
end

local itemlist = {}

for i,v in pairs(workspace:GetDescendants()) do
    if v:IsA("Tool") then
        --pcall(function ()
        if not table.find(itemlist, v.Name) then
        table.insert(itemlist, v.Name)
        end
        --end)
    end
end

local attack_tools = {
    "Axe",
    "Pickaxe",
    "Crowbar",
    "Hammer",
    "Knife",
    "Fist"
}

local function CheckRange(part1, part2, stud)
    range = (part1.Position - part2.Position).Magnitude
    if range < stud then
        return true
    end
    return false
end



function anime(id)
				local animation1 = Instance.new("Animation")
				--animation1.Name = "AttackMove"
				animation1.AnimationId = "rbxassetid://"..id
				local anim1 = game.Players.LocalPlayer.Character.Humanoid:LoadAnimation(animation1)
				anim1.Name = "AttackMove"
				task.wait()
				anim1:Play()
end
--[[
	task.spawn(function()
	while task.wait() do
	task.wait(0.1)
		--if char:FindFirstChild("Animate") then
			for i,v in ipairs(char.Humanoid:GetPlayingAnimationTracks()) do
				--print(v)
				if LP.Character.IsCuffed.Value == false then
				v:Stop()
				end 
			end 
		--end
	end
	end)
]]
function grabRemote()
	pcall(function()
		for idx, plr in pairs(Players:GetPlayers()) do
			if plr ~= LP 
            and CheckRange(LP.Character.HumanoidRootPart, plr.Character.HumanoidRootPart, 20)
			and plr.Character.Hostile.Value 
            --and LP.Team ~= plr.Team 
            and plr.Character.Humanoid.Health ~= 0 
			then
                print(plr)
				Remotes["Grab"]:FireServer(plr.Character, "Grab")
			end
		end
	end) 
end

local CFFFFFF = false

function CuffRemote()
    if CFFFFFF == false then
        local alreadyProcessedPlayers = {}

        for idx, plr in pairs(Players:GetPlayers()) do
            if plr ~= LP 
                and not alreadyProcessedPlayers[plr]
                and CheckRange(LP.Character.HumanoidRootPart, plr.Character.HumanoidRootPart, 15)
                and plr.Character.Hostile.Value 
                and LP.Team ~= plr.Team 
                and plr.Character.Humanoid.Health ~= 0 
                and (plr.Character.IsCuffed.Value == true or plr.Character.FrontCuffed.Value == true)
            then
                Remotes["UnCuffed"]:FireServer(plr.Character)
                alreadyProcessedPlayers[plr] = true
            end
        end

        -- 실행 후 플레이어를 리셋합니다.
        wait(1) -- 5초 후에 리셋하도록 설정되어 있습니다. 필요에 따라 조정 가능합니다.
        for k, _ in pairs(alreadyProcessedPlayers) do
            alreadyProcessedPlayers[k] = nil
        end

    elseif CFFFFFF == true then
        local alreadyProcessedPlayers = {}

        for idx, plr in pairs(Players:GetPlayers()) do
            if plr ~= LP 
                and not alreadyProcessedPlayers[plr]
                and CheckRange(LP.Character.HumanoidRootPart, plr.Character.HumanoidRootPart, 10)
                and plr.Character.Hostile.Value 
                and LP.Team ~= plr.Team 
                and plr.Character.Humanoid.Health ~= 0 
                and plr.Character.IsCuffed.Value == false
            then
                if player.Character:FindFirstChild("Handcuffs") then
                    Remotes["UnCuffed"]:FireServer(plr.Character)
                    task.wait(0.1)
                    Remotes["IsCuffed"]:FireServer(LP.Character:WaitForChild("Handcuffs"), plr.Character)
                elseif player.Character:FindFirstChild("Handcuffs (fugitive)") then
                    Remotes["UnCuffed"]:FireServer(plr.Character)
                    task.wait(0.1)
                    Remotes["IsCuffed"]:FireServer(LP.Character:WaitForChild("Handcuffs (fugitive)"), plr.Character)
                end
                alreadyProcessedPlayers[plr] = true
            end
        end

        -- 실행 후 플레이어를 리셋합니다.
        wait(1) -- 5초 후에 리셋하도록 설정되어 있습니다. 필요에 따라 조정 가능합니다.
        for k, _ in pairs(alreadyProcessedPlayers) do
            alreadyProcessedPlayers[k] = nil
        end
    end
end


function HogRemote()
	pcall(function()
		for idx, plr in pairs(Players:GetPlayers()) do
			if plr ~= LP 
            and CheckRange(LP.Character.HumanoidRootPart, plr.Character.HumanoidRootPart, 10)
			and plr.Character.Hostile.Value 
            and LP.Team ~= plr.Team 
            and plr.Character.Humanoid.Health ~= 0 
			then
				print(plr.Name,"Hog")
				if CFFFFFF == false then
					if plr.Character.IsHogged.Value == true then
						Remotes["IsHog"]:FireServer(plr.Character,"UnHog")
					end
					--CFFFFFF = true
				elseif CFFFFFF == true then
					if plr.Character.IsHogged.Value == false then
						Remotes["IsHog"]:FireServer(plr.Character,"Hog")
					end
				end
			end
		end
	end) 
end

function attack()
	pcall(function()
		local tool
		for i,v in pairs(attack_tools) do
			local t = LP.Character:FindFirstChild(v)
			if t then
				tool = t
				break
			end
		end
		for idx, plr in pairs(Players:GetPlayers()) do
			if
				plr ~= LP and CheckRange(LP.Character.HumanoidRootPart, plr.Character.HumanoidRootPart, 15)
				 and plr.Character.Hostile.Value and LP.Team ~= plr.Team and plr.Character.Humanoid.Health ~= 0 
			then
				if _G.OneTeamhit == true then
					if plr.Team.Name == _G.OneTeam then
						Remotes["Combat"]:FireServer(LP.Character, plr.Character.Head, tool)
						task.wait()
					end
				elseif _G.OneTeamhit == false then
					if LP.Team.Name == "Civilian" and plr.Team.Name ~= "Guard" then
						Remotes["Combat"]:FireServer(LP.Character, plr.Character.Head, tool)
						task.wait()
					elseif LP.Team.Name ~= "Civilian" then
						Remotes["Combat"]:FireServer(LP.Character, plr.Character.Head, tool)
						task.wait()
					end
				end
			end
		end
	end) 
end



game:GetService("UserInputService").InputBegan:Connect(function(inp)
    if inp.KeyCode == Enum.KeyCode.Q then
		if player.Character:FindFirstChild("Axe") then
			anime(7286445304)
			attack()
		elseif player.Character:FindFirstChild("Crowbar") then
			if m2 == true then
			anime(7137390931)
			attack()
			m2 = false
			else
				anime(7137385893)
				attack()
				m2 = true
			end
		elseif player.Character:FindFirstChild("Pickaxe") then
			anime(7098129399)
			attack()
		elseif player.Character:FindFirstChild("Knife") then
			if m1 == true then
				anime(7575196416)
				attack()
				m1 = false
			else
				anime(7562485782)
				attack()
				m1 = true
			end
		elseif player.Character:FindFirstChild("Fist") then
			if m3 == true then
				anime(6884302925)
				attack()
				m3 = false
			else
				anime(6884306689)
				attack()
				m3 = true
			end
		elseif player.Character:FindFirstChild("Hammer") then
			anime(6884398841)
			attack()
		elseif player.Character:FindFirstChild("Food") then
			Remotes["EatingEvent"]:FireServer(
				LP.Character,
				game:GetService("Players").LocalPlayer.Character.Food,
				"Heal")
		elseif player.Character:FindFirstChild("Hamburger") then
			Remotes["EatingEvent"]:FireServer(
				LP.Character,
				game:GetService("Players").LocalPlayer.Character.Hamburger,
				"Heal")
		elseif player.Character:FindFirstChild("Taser") then
			pos = game:GetService("Players").LocalPlayer.Character.Torso.CFrame.Position
			tpos = game:GetService("Players"):WaitForChild(_G.targetr).Character.Torso.CFrame.Position
			if player.Character.Taser.Charged.Value == true then
				spawn(function()	
				local args = {
						[1] = "Generate",
						[2] = game:GetService("Players").LocalPlayer.Character.Taser,
						[3] = Vector3.new(pos.X,pos.Y,pos.Z),
						[4] = Vector3.new(tpos.X,tpos.Y,tpos.Z)
					}
					
					game:GetService("ReplicatedStorage"):WaitForChild("Tase"):FireServer(unpack(args))
				end)
				local args = {
					[1] = "Hit",
					[2] = game:GetService("Players").LocalPlayer.Character.Taser,
					[3] = game:GetService("Players"):WaitForChild(_G.targetr).Character.Head
				}
				game:GetService("ReplicatedStorage"):WaitForChild("Tase"):FireServer(unpack(args))
			elseif player.Character.Taser.Charged.Value == false then
				--wait(0.5)
				anime(8109052918)
				local args = {
					[1] = "Recharge",
					[2] = game:GetService("Players").LocalPlayer.Character.Taser
				}
				
				game:GetService("ReplicatedStorage"):WaitForChild("Tase"):FireServer(unpack(args))
		
				end
			end
		elseif player.Character:FindFirstChild("Handcuffs") or player.Character:FindFirstChild("Handcuffs (fugitive)") then
			CuffRemote()
		elseif player.Character:FindFirstChild("Rope") then
			HogRemote()

	end
end)

game:GetService("UserInputService").InputBegan:Connect(function(inp)
    if inp.KeyCode == Enum.KeyCode.F then
		if LP.Character.GrabbingWhom.Value ~= nil then
			grabRemote()
		elseif LP.Character.GrabbingWhom.Value == nil then
			GW = LP.Character.GrabbingWhom.Value
			WTP = Players:FindFirstChild(GW)
			Remotes["Grab"]:FireServer(WTP.Character, "Drop")
		end
	end
end)

local StarterGui = game:GetService("StarterGui")

game:GetService("UserInputService").InputBegan:Connect(function(inp)
    if inp.KeyCode == Enum.KeyCode.G then
		if CFFFFFF == true then
			CFFFFFF = false
			StarterGui:SetCore("SendNotification", {
				Title = "Cuff and Hog";
				Text = "Remove"
			})
		elseif CFFFFFF == false then
			CFFFFFF = true
			StarterGui:SetCore("SendNotification", {
				Title = "Cuff and Hog";
				Text = "Add"
			})
		end
	end
end)

game:GetService("UserInputService").InputBegan:Connect(function(inp)
    if inp.KeyCode == Enum.KeyCode.V then
		char = game.Players.LocalPlayer.Character
		spawn(function()
			if char.HumanoidRootPart:FindFirstChild("Client") then
				char.HumanoidRootPart:FindFirstChild("Client"):Destroy()
			end
		end)
		spawn(function()
		anime(7568092298)
		end)
          --char.Humanoid:ChangeState(Enum.HumanoidStateType.Swimming)
          tar = char.HumanoidRootPart.CFrame*CFrame.new(0,15,0) + game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame.lookVector * 60
          --char.Humanoid:ChangeState(Enum.HumanoidStateType.Swimming)
          v2 = Instance.new('BodyPosition',char.HumanoidRootPart) 
          fol = Instance.new('Folder',v2)
          v2.Name = 'Client' 
          v2.MaxForce = Vector3.new(1,1,1)*100000 
          v2.D = 2500 
          v2.P = 60000 
          v2.Position = (tar).p
		  wait(0.2)
		  v2:Destroy()
	end
end)



